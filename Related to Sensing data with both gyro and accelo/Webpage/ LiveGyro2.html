<html>
   <head>
     <link type="text/css" rel="stylesheet" href="design.css">
      <title>Real Time Gyro Values</title>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.2/mqttws31.min.js" type="text/javascript">
	 </script>
	 <script type = "text/javascript" language = "javascript">
		var mqtt;
		var reconnectTimeout = 2000;
    var host="iot.eclipse.org";
    var port=1883;

    var prevX = 0;
    var prevY = 0;
    var prevZ = 0;

    var aprevX = 0;
    var aprevY = 0;
    var aprevZ = 0;

    var InitialStatus = false;
    //OR ......
		//var host="broker.hivemq.com";
		//var port=8000;



	 	function onConnect() {
	  // Once a connection has been made, make a subscription and send a message.

		console.log("Connected ");
		mqtt.subscribe("outsinhala12345");

      mqtt.onMessageArrived = function (message) {
      console.log("Live Feed: " + message.payloadString);
      var tempData=message.payloadString.split(',');
      var xGyro=parseFloat(tempData[0].split(':')[1]);
      var yGyro=parseFloat(tempData[1].split(':')[1]);
      var zGyro=parseFloat(tempData[2].split(':')[1]);


      var axGyro=parseFloat(tempData[3].split(':')[1]);
      var ayGyro=parseFloat(tempData[4].split(':')[1]);
      var azGyro=parseFloat(tempData[5].split(':')[1]);


      document.querySelector('#xID').textContent = xGyro;
      document.querySelector('#yID').textContent = yGyro;
      document.querySelector('#zID').textContent = zGyro;

      document.querySelector('#axID').textContent = axGyro;
      document.querySelector('#ayID').textContent = ayGyro;
      document.querySelector('#azID').textContent = azGyro;

      if(InitialStatus==false){
        InitialStatus = true;
        prevX = xGyro;
        prevY = yGyro;
        prevZ = zGyro;

        aprevX=axGyro;
        aprevY=ayGyro;
        aprevZ=azGyro;
      }
      else{
        if(Math.abs(prevX-xGyro)>=0.5||Math.abs(prevY-yGyro)>=0.5||Math.abs(prevZ-zGyro)>=0.5||
        Math.abs(aprevX-axGyro)>=0.5||Math.abs(aprevY-ayGyro)>=0.5||Math.abs(aprevZ-azGyro)>=0.5){

          document.querySelector('#vibID').textContent = "Activity Started !!!";
        }
        else{
          document.querySelector('#vibID').textContent = "Activity Stopped !!!";
        }
        prevX = xGyro;
        prevY = yGyro;
        prevZ = zGyro;

        aprevX=axGyro;
        aprevY=ayGyro;
        aprevZ=azGyro;
      }
      /*console.log("Topic:     " + message.destinationName);
      //console.log("QoS:       " + message.qos);
      //console.log("Retained:  " + message.retained);
      // Read Only, set if message might be a duplicate sent from broker
      //console.log("Duplicate: " + message.duplicate);
      //console.log(message);*/
      }

    //message = new Paho.MQTT.Message("Hello World");
		//message.destinationName = "outsinhala123";
		//mqtt.send(message);
	  }
	  function MQTTconnect() {
		console.log("connecting to "+ host +" "+ port);
    mqtt = new Paho.MQTT.Client("ws://iot.eclipse.org/ws", "outsinhala123");
		//document.write("connecting to "+ host);
		var options = {
			timeout: 3,
			onSuccess: onConnect,
		};

		mqtt.connect(options); //connect
		}

	  </script>
   </head>
     <body>


   <div class="wrapper1 clearfix">
       <div class="title">Real Time Gyro Values
        </div>
         <div class="xGyro-panel">
             <div class="initial-data" id="name-1">Yaw </div>
                <div class="initial-data-value" id="xID">Initialising ...
                </div>
          </div>

          <div class="yGyro-panel">
              <div class="initial-data" id="name-1">Roll
              </div>
                 <div class="initial-data-value" id="yID">Initialising ...
                 </div>
           </div>

           <div class="zGyro-panel">
               <div class="initial-data" id="name-1">Pitch
               </div>
                  <div class="initial-data-value" id="zID">Initialising ...
                  </div>
            </div>
            <!--
                  Acellometer Values
            -->
            <div class="xAccel-panel">
                <div class="initial-data" id="name-1">Ax
                </div>
                   <div class="initial-data-value" id="axID">Initialising ...
                   </div>
            </div>

             <div class="yAccel-panel">
                 <div class="initial-data" id="name-1">Ay
                 </div>
                    <div class="initial-data-value" id="ayID">Initialising ...
                    </div>
            </div>

            <div class="zAccel-panel">
                <div class="initial-data" id="name-1">Az
                </div>
                   <div class="initial-data-value" id="azID">Initialising ...
                   </div>
            </div>
    </div>

  <div class="wrapper2 clearfix">
  <div class="vib-box">Vibration Status
  <div class="vibStat" id="vibID">Initialising ...</div>
  </div>
  </div>

<div class="wrapper3 clearfix">

<div id="chartContainer" >

</div>

</div>



 	<script>
	MQTTconnect();
	</script>

  <script src="final.js"></script>
  <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
   </body>
</html>